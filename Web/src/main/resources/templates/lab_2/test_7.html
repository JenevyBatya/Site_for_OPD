<!DOCTYPE html>
<html>
<head>
    <style>
        #circle-container {
            position: relative;
            width: 300px;
            height: 300px;
            background-color: lightgray;
            border-radius: 50%;
            border: 1px solid black;
        }

        #circle {
            position: absolute;
            top: 50%;
            left: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
            transform: translate(-50%, -50%);
        }

        .star {
            position: absolute;
            right: 0;
            width: 10px;
            height: 10px;
            background-color: yellow;
            transform: translate(50%, -50%);
        }
    </style>
</head>
<body>
<div id="circle-container">
    <div id="circle"></div>
    <div class="star" style="top: 50%;" id="star_1"></div>
    <div class="star" style="top: 50%; left: -3%" id="star_2"></div>
    <div class="star" style="top: 90%; left: 75%;" id="star_3"></div>
</div>
<button id="startButton">Начать</button>

<script>
    let star_1 = document.getElementById('star_1');
    let star_2 = document.getElementById('star_2');
    let star_3 = document.getElementById('star_3');
    let timeTaken = 0;
    let circleSpeed;
    let correctAnswers = 0;
    let clicked = false;
    let firstTime = true;
    let circle = document.getElementById("circle");
    let color = getRandomColorMust(null);
    circle.style.background = color;

    function updateSpeed() {
        let speed = [0.5];
        circleSpeed = speed[Math.floor(Math.random() * speed.length)];
    }

    document.addEventListener('DOMContentLoaded', function () {
        let circleContainer = document.getElementById('circle-container');
        let circle = document.getElementById('circle');
        let startButton = document.getElementById('startButton');

        let reactionTime = 0;
        let circlePosition = 190;
        updateSpeed();

        function updateCircle() {
            console.log(clicked);
            let radius = circleContainer.offsetWidth / 2;
            let angle = (circlePosition / 180) * Math.PI;
            let circleX = radius * Math.cos(angle) + radius;
            let circleY = radius * Math.sin(angle) + radius;

            circle.style.left = circleX + 'px';
            circle.style.top = circleY + 'px';
            if (reactionTime === 0) {
                if (!firstTime) {
                    if (circlePosition === star_1.offsetLeft + 69 && clicked && color === 'orangered') {
                        reactionTime = performance.now();
                        clicked = false;
                    } else if (circlePosition === 56 && clicked && color === 'goldenrod') {
                        reactionTime = performance.now();
                        clicked = false;
                    } else if (circlePosition === 180 && clicked && color === 'turquoise') {
                        reactionTime = performance.now();
                        clicked = false;
                    }
                } else {
                    if (circlePosition === star_1.offsetLeft + 69 && color === 'orangered') {
                        reactionTime = performance.now();
                        clicked = false;
                        firstTime = false;
                    } else if (color === 'goldenrod' && circlePosition === 80) {
                        reactionTime = performance.now();
                        clicked = false;
                        firstTime = false;
                    } else if (color === 'turquoise' && circlePosition === 180) {
                        reactionTime = performance.now();
                        clicked = false;
                        firstTime = false;
                    }
                }
            }
            if (circlePosition >= 360) {
                circlePosition = 0;
            }

            circlePosition += circleSpeed;

            requestAnimationFrame(updateCircle);
        }

        startButton.addEventListener('click', function () {
            startButton.disabled = true; // Чтобы кнопка нельзя было нажать повторно
            updateCircle();
        });

        document.addEventListener('keydown', function (event) {
            if (event.code === 'Space') {
                if (reactionTime !== 0 && !clicked) {
                    let userReactionTime = performance.now() - reactionTime;
                    console.log('Ваша реакция: ' + userReactionTime.toFixed(2) + ' мс');
                    color = getRandomColorMust(color);
                    circle.style.background = color;
                    clicked = true;
                    updateSpeed();
                    timeTaken += reactionTime;
                    reactionTime = 0;
                    correctAnswers++;
                } else {
                    console.log('Промах! Нажмите пробел, когда круг проходит звездочку.');
                }
                reactionTime = 0;
            }
        });
    });

    function getRandomColorMust(colorNow) {
        let colors = ["turquoise", "goldenrod", "orangered"];
        let circleColor;
        if (colorNow === null) {
            let randomIndex = Math.floor(Math.random() * colors.length);
            circleClicked = false;
            circleColor = colors[randomIndex];
        } else {
            colors = colors.filter(function (item) {
                return item !== colorNow;
            });
            let randomIndex = Math.floor(Math.random() * colors.length);
            circleClicked = false;
            circleColor = colors[randomIndex];
        }
        console.log(circleColor);
        if (circleColor === 'turquoise') {
            star_2.style.background = 'yellow';
            star_2.style.opacity = 1;
            star_1.style.opacity = 0;
            star_3.style.opacity = 0;
        } else if (circleColor === 'goldenrod') {
            star_3.style.background = "yellow";
            star_3.style.opacity = 1;
            star_1.style.opacity = 0;
            star_2.style.opacity = 0;
        } else if (circleColor === 'orangered') {
            star_1.style.background = 'yellow';
            star_1.style.opacity = 1;
            star_2.style.opacity = 0;
            star_3.style.opacity = 0;
        }
        return circleColor;
    }
</script>
</body>
</html>
